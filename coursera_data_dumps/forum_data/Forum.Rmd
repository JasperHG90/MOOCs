---
title: "Working with the Coursera Forum Data"
author: "Jasper Ginn"
date: "`r Sys.Date()`"
output: html_document
---

# Introduction

This document covers some basic text processing in R using forum comments.

```{r}
# Set global knitr Options
require(knitr)
opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, tidy = FALSE, results = 'asis')
```

# Preparations

```{r}
# Clean wd
rm(list=ls())
# Load packages
packages <- c("RSQLite", "dplyr", "ggplot2", "scales")
for(package in packages) if(!require(package, character.only=TRUE)) install.packages(package)
# Load general helper functions
source("/Users/Jasper/Documents/Github.projects/MOOCs/workflow/generic_helper_functions/helper_functions.R")
# Load forum helper functions
source("/Users/Jasper/Documents/Github.projects/MOOCs/coursera_data_dumps/forum_data/forum_helper_functions.R")
# Data locations
data.dir <- "/users/jasper/desktop/TEMP"
files <- paste0(dir_end(data.dir), list.files(data.dir))
```

You can use the "dbQA" ("database Quick Access") function to get all table names residing in a SQLite database, e.g.:

```{r}
# Get all table names
tabs <- dbQA(files[1], show.table=TRUE)
# Print
knitr::kable(data.frame(Table_name = tabs))
```

|Table_name                  |
|:---------------------------|
|activity_log                |
|forum_comments              |
|forum_forums                |
|forum_posts                 |
|forum_reporting             |
|forum_reputation_points     |
|forum_reputation_record     |
|forum_subscribe_forums      |
|forum_subscribe_threads     |
|forum_tags                  |
|forum_tags_threads          |
|forum_threads               |
|kvs_course.forum_readrecord |

Similarly, you can use the dbQA quick function to query a table from the SQLite file, e.g.

```{r}
# We want all forum posts
for.comm <- dbQA(files[1], table = tabs[4], show.table=FALSE)
# Look at structure
str(for.comm)
# Col names
coln <- colnames(for.comm)
outVar <- c("user_id", "edit_time", "user_agent", "text_type")
# Take out variables listed above
for.comm <- for.comm[, which(!sapply(colnames(for.comm), function(x) x %in% outVar))]
```

We can convert and format the UNIX timestamps like so:

```{r}
# Convert unix timestamp
for.comm$post_time <- convertunixtm(for.comm$post_time)
# Format to only keep date
for.comm$post_date <- strftime(for.comm$post_time, format="%Y-%m-%d")
```

This way, we can get an idea of when people post comments:

```{r}
# Tally
for.comm.sum <- for.comm %>%
  group_by(post_date) %>%
  tally() %>%
  as.data.frame(.) 
# Convert to date
for.comm.sum$post_date <- as.Date(ymd(for.comm.sum$post_date))
# Plot
ggplot(for.comm.sum, aes(x=post_date, y=n)) +
  geom_line() +
  scale_x_date() +
  theme_bw()
```

![forum comments](https://dl.dropboxusercontent.com/u/38011066/CFI/plots/forumcomments.png)