---
title: "Working with the Coursera Forum Data"
author: "Jasper Ginn"
date: "`r Sys.Date()`"
output: html_document
---

# Introduction

This document outlines several ways to work with the Coursera forum data.

```{r}
# Set global knitr Options
require(knitr)
opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, tidy = FALSE, results = 'asis')
```

# Preparations

```{r}
# Clean wd
rm(list=ls())
# Load packages
packages <- c("RSQLite", "dplyr", "stargazer")
for(package in packages) if(!require(package, character.only=TRUE)) install.packages(package)
# Load general helper functions
source("/Users/Jasper/Documents/Github.projects/MOOCs/workflow/generic_helper_functions/helper_functions.R")
# Load forum helper functions
source("/Users/Jasper/Documents/Github.projects/MOOCs/coursera_data_dumps/forum_data/forum_helper_functions.R")
# Data locations
data.dir <- "/users/jasper/desktop/TEMP"
files <- paste0(dir_end(data.dir), list.files(data.dir))
```

You can use the "dbQA" ("database Quick Access") function to get all table names residing in a SQLite database, e.g.:

```{r}
# Get all table names
tabs <- dbQA(files[1], show.table=TRUE)
# Print
knitr::kable(data.frame(Table_name = tabs))
```

|Table_name                  |
|:---------------------------|
|activity_log                |
|forum_comments              |
|forum_forums                |
|forum_posts                 |
|forum_reporting             |
|forum_reputation_points     |
|forum_reputation_record     |
|forum_subscribe_forums      |
|forum_subscribe_threads     |
|forum_tags                  |
|forum_tags_threads          |
|forum_threads               |
|kvs_course.forum_readrecord |

Similarly, you can use the dbQA quick function to query a table from the SQLite file, e.g.

```{r}
# We want all forum posts
for.comm <- dbQA(files[1], table = tabs[4], show.table=FALSE)
# Look at structure
str(for.comm)
# Col names
coln <- colnames(for.comm)
outVar <- c("user_id", "edit_time", "user_agent", "text_type")
# Take out variables listed above
for.comm <- for.comm[, which(!sapply(colnames(for.comm), function(x) x %in% outVar))]
```

One of the problems with the forum data is that the text is essentially wrapped in html code. Plus, it doesn't behave quite nicely. Before exploring relatively advanced procedures (such as stemming etc.),  we can pre-process this data with some simple convenience functions to strip the html and replace all URLs:

```{r}
# Strip html
for.comm$cleaned_text <- removehtml(for.comm$post_text)
# Take out URLs
for.comm$cleaned_text <- removeurl(for.comm$cleaned_text)
```

Another issue is the character encoding. Essentially, we want the text to be in ASCII format if we are to process it in R:

```{r}
# Convert to ASCII
for.comm$cleaned_text <- iconv(for.comm$cleaned_text, "latin1", "ASCII", sub="")
```









